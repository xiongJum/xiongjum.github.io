<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>接口自动化测试 - LongLit</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="准备 准备库 requests 和 unittest
pip install requests 编写测试脚本 封装公共参数 封装公共参数，重复调取结果，减少代码的编写量，降低理解难度。
设置接口的必填参数，并使用 *args 传入接口的非必填参数；使用 **kwargs 设置一些条件。 可以将一些公共参数写入到单独的文件中，使用时引用即可；一些隐私的数据可以写入到#环境变量中中，如测试 api 或者测试账号。
import requests import unittest class RequestTest(unittest.TestCase): # 封装公共参数 def common(self, name, password, *args, **kwargs): url = f&#34;{config.ENVIRONMENT}/auth/login&#34; param = {&#34;name&#34;:name, &#34;password&#34;:password,} if args: # 如果 args 不为空 则将参数传入添加到请求参数中 for arg in args: param.update(**arg) self.response = requests.post(url, headers=self.headers, json=param, verify=False,) # 如果 kwargs 不为 False 则进行相应的操作 if kwargs: for key, value in kwargs." />
	<meta property="og:image" content=""/>
	<meta property="og:title" content="接口自动化测试" />
<meta property="og:description" content="准备 准备库 requests 和 unittest
pip install requests 编写测试脚本 封装公共参数 封装公共参数，重复调取结果，减少代码的编写量，降低理解难度。
设置接口的必填参数，并使用 *args 传入接口的非必填参数；使用 **kwargs 设置一些条件。 可以将一些公共参数写入到单独的文件中，使用时引用即可；一些隐私的数据可以写入到#环境变量中中，如测试 api 或者测试账号。
import requests import unittest class RequestTest(unittest.TestCase): # 封装公共参数 def common(self, name, password, *args, **kwargs): url = f&#34;{config.ENVIRONMENT}/auth/login&#34; param = {&#34;name&#34;:name, &#34;password&#34;:password,} if args: # 如果 args 不为空 则将参数传入添加到请求参数中 for arg in args: param.update(**arg) self.response = requests.post(url, headers=self.headers, json=param, verify=False,) # 如果 kwargs 不为 False 则进行相应的操作 if kwargs: for key, value in kwargs." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xiongjum.github.io/post/code/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95-%E6%8E%A5%E5%8F%A3/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-12-26T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-12-26T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="接口自动化测试"/>
<meta name="twitter:description" content="准备 准备库 requests 和 unittest
pip install requests 编写测试脚本 封装公共参数 封装公共参数，重复调取结果，减少代码的编写量，降低理解难度。
设置接口的必填参数，并使用 *args 传入接口的非必填参数；使用 **kwargs 设置一些条件。 可以将一些公共参数写入到单独的文件中，使用时引用即可；一些隐私的数据可以写入到#环境变量中中，如测试 api 或者测试账号。
import requests import unittest class RequestTest(unittest.TestCase): # 封装公共参数 def common(self, name, password, *args, **kwargs): url = f&#34;{config.ENVIRONMENT}/auth/login&#34; param = {&#34;name&#34;:name, &#34;password&#34;:password,} if args: # 如果 args 不为空 则将参数传入添加到请求参数中 for arg in args: param.update(**arg) self.response = requests.post(url, headers=self.headers, json=param, verify=False,) # 如果 kwargs 不为 False 则进行相应的操作 if kwargs: for key, value in kwargs."/>
<script src="https://xiongjum.github.io/js/feather.min.js"></script>
	
	
        <link href="https://xiongjum.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://xiongjum.github.io/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://xiongjum.github.io/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css" media="(prefers-color-scheme: dark)"  />
	

	
	

	
	
	
	
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://xiongjum.github.io/">LongLit</a>
	</div>
	<div>
		<a href="/categories/编程">编程</a>
		<a href="/categories/玩机">玩机</a>
		<a href="/categories/笔记">笔记</a>
	</div>
	<nav>
		
		<a href="/post">文章</a>
		
		<a href="/tags">标签</a>
		
		<a href="/mark">书签</a>
		
		<a href="/about">关于</a>
		
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">接口自动化测试</h1>
			<div class="meta">Posted on 2021,12,26.  222 pcs   
			</div>
		</div>
		

		<aside>
			<nav id="TableOfContents">
  <ul>
    <li><a href="#封装公共参数">封装公共参数</a></li>
    <li><a href="#编写装饰器">编写装饰器</a></li>
  </ul>
</nav>
		</aside>	  

		<section class="body">
			<h1 id="准备">准备</h1>
<p>准备库 <a href="https://docs.python-requests.org/zh_CN/latest/">requests</a> 和 <a href="https://docs.python.org/zh-cn/3/library/unittest.html">unittest</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>pip install requests
</span></span></code></pre></div><h1 id="编写测试脚本">编写测试脚本</h1>
<h2 id="封装公共参数">封装公共参数</h2>
<p>封装公共参数，重复调取结果，减少代码的编写量，降低理解难度。</p>
<p>设置接口的必填参数，并使用 *args 传入接口的非必填参数；使用 **kwargs 设置一些条件。
可以将一些公共参数写入到单独的文件中，使用时引用即可；一些隐私的数据可以写入到<a href="/tags/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">#环境变量中</a>中，如测试 api 或者测试账号。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> unittest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RequestTest</span>(unittest<span style="color:#f92672">.</span>TestCase):
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span> 	<span style="color:#75715e"># 封装公共参数</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">common</span>(self, name, password, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
</span></span><span style="display:flex;"><span>		url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>config<span style="color:#f92672">.</span>ENVIRONMENT<span style="color:#e6db74">}</span><span style="color:#e6db74">/auth/login&#34;</span>
</span></span><span style="display:flex;"><span>		param <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;name&#34;</span>:name, <span style="color:#e6db74">&#34;password&#34;</span>:password,}
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> args: <span style="color:#75715e"># 如果 args 不为空 则将参数传入添加到请求参数中</span>
</span></span><span style="display:flex;"><span>			 <span style="color:#66d9ef">for</span> arg <span style="color:#f92672">in</span> args:
</span></span><span style="display:flex;"><span>				 param<span style="color:#f92672">.</span>update(<span style="color:#f92672">**</span>arg)
</span></span><span style="display:flex;"><span>		self<span style="color:#f92672">.</span>response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(url, headers<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>headers, json<span style="color:#f92672">=</span>param, 
</span></span><span style="display:flex;"><span>									  verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		 <span style="color:#75715e"># 如果 kwargs 不为 False 则进行相应的操作</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> kwargs:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">for</span> key, value <span style="color:#f92672">in</span> kwargs<span style="color:#f92672">.</span>items():
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">if</span> key <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;del_&#39;</span> <span style="color:#f92672">and</span> value : <span style="color:#75715e"># 如果 key 为 del_ 则删除本次测试所产生的数据</span>
</span></span><span style="display:flex;"><span>					self<span style="color:#f92672">.</span>db<span style="color:#f92672">.</span>commit_data(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;delete from mp_org where phone=&#39;</span><span style="color:#e6db74">{</span>phone<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>response
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>	unittest<span style="color:#f92672">.</span>main(verbosity<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span></code></pre></div><p>调取公共参数，请求项目的外部接口获取请求结果, 并根据结果进行断言</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RequestTest</span>(unittest<span style="color:#f92672">.</span>TestCase):
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">...</span> skip
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_login</span>(self):
</span></span><span style="display:flex;"><span>		self<span style="color:#f92672">.</span>common(name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;admin&#39;</span>, password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;passwd&#39;</span>)
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 断言</span>
</span></span><span style="display:flex;"><span>		self<span style="color:#f92672">.</span>assertEqual(self<span style="color:#f92672">.</span>response<span style="color:#f92672">.</span>status_code, <span style="color:#ae81ff">200</span>)
</span></span><span style="display:flex;"><span> 		self<span style="color:#f92672">.</span>assertEqual(self<span style="color:#f92672">.</span>response<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#39;code&#39;</span>], <span style="color:#ae81ff">0</span>, msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;返回的状态码不为0&#39;</span>)
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>	unittest<span style="color:#f92672">.</span>main(verbosity<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span></code></pre></div><h2 id="编写装饰器">编写装饰器</h2>
<p>将相同的断言放入 <a href="https://docs.python.org/zh-cn/3/library/typing.html#functions-and-decorators">#装饰器</a>中，以供重复使用</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># decorators.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lsgot_success</span>(f):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@wraps</span>(f)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decorator</span>(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
</span></span><span style="display:flex;"><span>		f(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs)
</span></span><span style="display:flex;"><span>		responseJSON <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>response<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>		print(responseJSON)
</span></span><span style="display:flex;"><span>		self<span style="color:#f92672">.</span>assertEqual(self<span style="color:#f92672">.</span>response<span style="color:#f92672">.</span>status_code, <span style="color:#ae81ff">200</span>,)
</span></span><span style="display:flex;"><span>		self<span style="color:#f92672">.</span>assertEqual(responseJSON[<span style="color:#e6db74">&#39;code&#39;</span>], <span style="color:#ae81ff">0</span>, msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;返回的状态码不为0&#39;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> f(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> decorator
</span></span></code></pre></div><p>修改测试方法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> decorators <span style="color:#f92672">import</span> lsgot_success
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RequestTest</span>(unittest<span style="color:#f92672">.</span>TestCase):
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">...</span> skip
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@lsgot_success</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_login</span>(self):
</span></span><span style="display:flex;"><span>		self<span style="color:#f92672">.</span>common(name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;admin&#39;</span>, password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;passwd&#39;</span>)
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>	unittest<span style="color:#f92672">.</span>main(verbosity<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span></code></pre></div><p>若接口需要 cookie 之类的凭证，可以编写单独的方法，在运行测试之前写入到 cookie 或者 headers 中。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">login</span>():
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(url<span style="color:#f92672">=</span>url, headers<span style="color:#f92672">=</span>config<span style="color:#f92672">.</span>CONFING<span style="color:#f92672">.</span>LOGIN_HEADERS, 
</span></span><span style="display:flex;"><span>							 data<span style="color:#f92672">=</span>param, verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 获取登录结果返回的响应， 并将 Authorization 写入到 headers 中。</span>
</span></span><span style="display:flex;"><span>	headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;Authorization&#34;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Bearer </span><span style="color:#e6db74">{</span>response<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#39;access_token&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/json;charset=UTF-8&#34;</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> headers
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RequestTest</span>(unittest<span style="color:#f92672">.</span>TestCase):
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">setUp</span>(self):
</span></span><span style="display:flex;"><span>		self<span style="color:#f92672">.</span>headers <span style="color:#f92672">=</span> login()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> skip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	unittest<span style="color:#f92672">.</span>main(verbosity<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span></code></pre></div><p>如果在测试过程中需要访问数据库，访问这篇文章<a href="">在 Python 中访问 SQL</a></p>
<p>谢谢</p>
<h1 id="参考">参考</h1>
<p>[1] 由于链接消失，暂时无法展示，以后找到后补上</p>

		</section>

		<div class="post-tags">
			
			
			<nav class="nav tags">
				<ul class="tags">
					
					<li><a href="/tags/python3">Python3</a></li>
					
					<li><a href="/tags/%E6%B5%8B%E8%AF%95">测试</a></li>
					
				</ul>
			</nav>
			
			
		</div>
		</article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="https://github.com/athul/archie" rel="me" title="GitHub"><i data-feather="github"></i></a>
    <a class="border"></a></div>
  <div class="footer-info">
    2024  © LongLit |  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>


<script>
  feather.replace()
</script></div>
    </body>
</html>
