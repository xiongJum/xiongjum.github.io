<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>接口自动化测试 · Lain</title><meta name="description" content="接口自动化测试 - null"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/gandalfr.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/solarized-light.min.css"><link rel="search" type="application/opensearchdescription+xml" href="https://blog.lain.buzz/atom.xml" title="Lain"><meta name="generator" content="Hexo 7.0.0-rc1"><link rel="alternate" href="/atom.xml" title="Lain" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="https://avatars1.githubusercontent.com/u/3142935?v=3&amp;s=466 or file" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">接口自动化测试</h1><div class="tags"><a href="/tags/Python/" class="tag-title">#Python</a><a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" class="tag-title">#自动化测试</a><a href="/tags/%E6%8E%A5%E5%8F%A3%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" class="tag-title">#接口自动化测试</a><a href="/tags/requests/" class="tag-title">#requests</a><a href="/tags/unittest/" class="tag-title">#unittest</a></div><div class="post-info">2021年12月26日</div><div class="post-content"><p>基于 requests 库 和 unittest 库，编写的脚本 demo，还存在不成熟的地方。</p>
<span id="more"></span>


<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><p>准备库 <a target="_blank" rel="noopener" href="https://docs.python-requests.org/zh_CN/latest/">requests</a> 和 <a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/unittest.html">unittest</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">pip install requests<br></code></pre></td></tr></table></figure>

<h1 id="编写测试脚本"><a href="#编写测试脚本" class="headerlink" title="编写测试脚本"></a>编写测试脚本</h1><h2 id="封装公共参数"><a href="#封装公共参数" class="headerlink" title="封装公共参数"></a>封装公共参数</h2><p>封装公共参数，重复调取结果，减少代码的编写量，降低理解难度。</p>
<p>设置接口的必填参数，并使用 *args 传入接口的非必填参数；使用 **kwargs 设置一些条件。<br>可以将一些公共参数写入到单独的文件中，使用时引用即可；一些隐私的数据可以写入到<a href="/tags/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">#环境变量中</a>中，如测试 api 或者测试账号。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> unittest<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestTest</span>(unittest.TestCase):<br>	<br> 	<span class="hljs-comment"># 封装公共参数</span><br>	 <span class="hljs-keyword">def</span> <span class="hljs-title function_">common</span>(<span class="hljs-params">self, name, password, *args, **kwargs</span>):<br>		url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;config.ENVIRONMENT&#125;</span>/auth/login&quot;</span><br>		param = &#123;<span class="hljs-string">&quot;name&quot;</span>:name, <span class="hljs-string">&quot;password&quot;</span>:password,&#125;<br>		<br>		<span class="hljs-keyword">if</span> args: <span class="hljs-comment"># 如果 args 不为空 则将参数传入添加到请求参数中</span><br>			 <span class="hljs-keyword">for</span> arg <span class="hljs-keyword">in</span> args:<br>				 param.update(**arg)<br>		self.response = requests.post(url, headers=self.headers, json=param, <br>									  verify=<span class="hljs-literal">False</span>,)<br><br>		 <span class="hljs-comment"># 如果 kwargs 不为 False 则进行相应的操作</span><br>		<span class="hljs-keyword">if</span> kwargs:<br>			<span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> kwargs.items():<br>				<span class="hljs-keyword">if</span> key == <span class="hljs-string">&#x27;del_&#x27;</span> <span class="hljs-keyword">and</span> value : <span class="hljs-comment"># 如果 key 为 del_ 则删除本次测试所产生的数据</span><br>					self.db.commit_data(<span class="hljs-string">f&quot;delete from mp_org where phone=&#x27;<span class="hljs-subst">&#123;phone&#125;</span>&#x27;&quot;</span>)<br><br>		<span class="hljs-keyword">return</span> self.response<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>	unittest.main(verbosity=<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure>

<p>调取公共参数，请求项目的外部接口获取请求结果, 并根据结果进行断言</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestTest</span>(unittest.TestCase):<br>	<br>	... skip<br>	<br>	<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_login</span>(<span class="hljs-params">self</span>):<br>		self.common(name=<span class="hljs-string">&#x27;admin&#x27;</span>, password=<span class="hljs-string">&#x27;passwd&#x27;</span>)<br>		<br>		<span class="hljs-comment"># 断言</span><br>		self.assertEqual(self.response.status_code, <span class="hljs-number">200</span>)<br> 		self.assertEqual(self.response.json()[<span class="hljs-string">&#x27;code&#x27;</span>], <span class="hljs-number">0</span>, msg=<span class="hljs-string">&#x27;返回的状态码不为0&#x27;</span>)<br>		<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>	unittest.main(verbosity=<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure>

<h2 id="编写装饰器"><a href="#编写装饰器" class="headerlink" title="编写装饰器"></a>编写装饰器</h2><p>将相同的断言放入 <a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/typing.html#functions-and-decorators">#装饰器</a>中，以供重复使用</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># decorators.py</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">lsgot_success</span>(<span class="hljs-params">f</span>):<br><br><span class="hljs-meta">	@wraps(<span class="hljs-params">f</span>)</span><br>	<span class="hljs-keyword">def</span> <span class="hljs-title function_">decorator</span>(<span class="hljs-params">self, *args, **kwargs</span>):<br>		f(self, *args, **kwargs)<br>		responseJSON = self.response.json()<br>		<span class="hljs-built_in">print</span>(responseJSON)<br>		self.assertEqual(self.response.status_code, <span class="hljs-number">200</span>,)<br>		self.assertEqual(responseJSON[<span class="hljs-string">&#x27;code&#x27;</span>], <span class="hljs-number">0</span>, msg=<span class="hljs-string">&#x27;返回的状态码不为0&#x27;</span>)<br>		<span class="hljs-keyword">return</span> f(self, *args, **kwargs)<br>	<span class="hljs-keyword">return</span> decorator<br></code></pre></td></tr></table></figure>

<p>修改测试方法</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> decorators <span class="hljs-keyword">import</span> lsgot_success<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestTest</span>(unittest.TestCase):<br>	<br>	... skip<br>	<br><span class="hljs-meta">	@lsgot_success</span><br>	<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_login</span>(<span class="hljs-params">self</span>):<br>		self.common(name=<span class="hljs-string">&#x27;admin&#x27;</span>, password=<span class="hljs-string">&#x27;passwd&#x27;</span>)<br>		<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>	unittest.main(verbosity=<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure>

<p>若接口需要 cookie 之类的凭证，可以编写单独的方法，在运行测试之前写入到 cookie 或者 headers 中。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br><br>	response = requests.post(url=url, headers=config.CONFING.LOGIN_HEADERS, <br>							 data=param, verify=<span class="hljs-literal">False</span>)<br>	<br>	<span class="hljs-comment"># 获取登录结果返回的响应， 并将 Authorization 写入到 headers 中。</span><br>	headers = &#123;<br>		<span class="hljs-string">&quot;Authorization&quot;</span>: <span class="hljs-string">f&quot;Bearer <span class="hljs-subst">&#123;response.json()[<span class="hljs-string">&#x27;access_token&#x27;</span>]&#125;</span>&quot;</span>,<br>		<span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span><br>		&#125;<br>	<span class="hljs-keyword">return</span> headers<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestTest</span>(unittest.TestCase):<br>	<br>	<span class="hljs-keyword">def</span> <span class="hljs-title function_">setUp</span>(<span class="hljs-params">self</span>):<br>		self.headers = login()<br><br><span class="hljs-meta">... </span>skip<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>	<br>	unittest.main(verbosity=<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure>

<p>如果在测试过程中需要访问数据库，访问这篇文章<a href="">在 Python 中访问 SQL</a></p>
<p>谢谢</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>[1] 由于链接消失，暂时无法展示，以后找到后补上</p>
</div></article></div></main><footer><div class="paginator"><a href="/2022/01/18/tools_jupyter/" class="prev">PREV</a><a href="/2021/12/24/code_PyPi/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 - 2023 <a href="https://blog.lain.buzz"></a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/MikeCoder/hexo-theme-gandalfr" target="_blank">hexo-theme-gandalfr</a>.</p></div></footer></div><script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js" crossorigin="anonymous"></script><script src="//cdn.bootcss.com/jquery/3.1.1/jquery.js" crossorigin="anonymous"></script><script>$(document).ready(function() { hljs.configure({useBR: true}); $('pre').each(function(i, block) { hljs.highlightBlock(block); }); });</script></body></html>